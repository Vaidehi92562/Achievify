<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Achievify — Login</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{--ink:#0f172a;--ring:rgba(15,23,42,.12);--bg:#f7f8fc}
  *{box-sizing:border-box}html,body{height:100%}
  body{
    margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Arial; background:var(--bg); color:var(--ink);
    display:grid; place-items:center; padding:28px;
  }
  .card{
    width:min(480px,92vw); background:#fff; border:1px solid var(--ring); border-radius:16px;
    box-shadow:0 14px 40px var(--ring); padding:26px;
  }
  h1{margin:0 0 6px; font-size:28px}
  p.sub{margin:0 0 18px; opacity:.7}
  form{display:grid; gap:14px; margin-top:8px}
  label{font-weight:600; font-size:14px}
  input{
    width:100%; padding:12px; border-radius:10px; border:1px solid #e5e7eb; font-size:15px; outline:none;
  }
  input:focus{border-color:#111827}
  .btn{
    margin-top:8px; display:inline-flex; align-items:center; justify-content:center; gap:10px;
    border:none; border-radius:12px; padding:12px 16px; background:#111827; color:#fff; font-weight:700; cursor:pointer;
  }
  .btn[disabled]{opacity:.6; cursor:not-allowed}
  .msg{margin-top:10px; font-size:14px}
  .msg.error{color:#b91c1c} .msg.success{color:#166534}
  .footer{margin-top:16px; font-size:14px}
  a{color:#111827; text-decoration:none}
  a:hover{text-decoration:underline}
</style>
</head>
<body>
  <div class="card">
    <h1>Welcome back</h1>
    <p class="sub">New here? <a href="register.html">Create an account</a></p>

    <form id="loginForm" novalidate>
      <div>
        <label for="userOrEmail">Username or Email</label>
        <input id="userOrEmail" name="userOrEmail" type="text" required />
      </div>
      <div>
        <label for="password">Password</label>
        <input id="password" name="password" type="password" required />
      </div>

      <button class="btn" id="loginBtn" type="submit">
        <span id="btnText">Login</span>
        <span id="spinner" style="display:none">⏳</span>
      </button>
      <div class="msg" id="msg"></div>
    </form>

    <div class="footer"><a href="index.html">← Back to home</a></div>
  </div>

<script>
const form = document.getElementById('loginForm');
const msg  = document.getElementById('msg');
const btn  = document.getElementById('loginBtn');
const spinner = document.getElementById('spinner');
const btnText = document.getElementById('btnText');

function setMessage(text, ok=false){
  msg.textContent = text;
  msg.className = 'msg ' + (ok ? 'success' : 'error');
}
function setLoading(on){
  btn.disabled = on; spinner.style.display = on ? 'inline' : 'none';
  btnText.textContent = on ? 'Checking…' : 'Login';
}

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  setMessage(''); setLoading(true);

  const data = Object.fromEntries(new FormData(form).entries());
  if(!data.userOrEmail || !data.password){
    setLoading(false); return setMessage('Please fill both fields.');
  }

  try{
    const res = await fetch('/api/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ userOrEmail: data.userOrEmail.trim(), password: data.password })
    });
    const out = await res.json().catch(()=> ({}));

    if(res.ok){
      // save basic user info for greeting later
      localStorage.setItem('achievifyUser', JSON.stringify(out.user));
      setMessage('Logged in ✔ Redirecting…', true);
     setTimeout(()=> location.href = 'dashboard.html', 900);

    } else {
      setMessage(out.message || 'Login failed.');
    }
  }catch(err){
    setMessage('Server not reachable. Open via http://localhost:PORT from your Node server.');
  }finally{
    setLoading(false);
  }
});
</script>
</body>
</html>
