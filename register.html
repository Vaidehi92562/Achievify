<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Achievify — Register</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{--ink:#0f172a;--ring:rgba(15,23,42,.12);--bg:#f7f8fc}
  *{box-sizing:border-box}html,body{height:100%}
  body{
    margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Arial; background:var(--bg); color:var(--ink);
    display:grid; place-items:center; padding:28px;
  }
  .card{
    width:min(560px,92vw); background:#fff; border:1px solid var(--ring); border-radius:16px;
    box-shadow:0 14px 40px var(--ring); padding:26px;
  }
  h1{margin:0 0 4px; font-size:28px}
  p.sub{margin:0 0 18px; opacity:.7}
  form{display:grid; gap:14px; margin-top:8px}
  .row{display:grid; gap:12px; grid-template-columns:1fr 1fr}
  label{font-weight:600; font-size:14px}
  input{
    width:100%; padding:12px; border-radius:10px; border:1px solid #e5e7eb; font-size:15px; outline:none;
    transition:border .15s ease;
  }
  input:focus{border-color:#111827}
  .btn{
    margin-top:8px; display:inline-flex; align-items:center; justify-content:center; gap:10px;
    border:none; border-radius:12px; padding:12px 16px; background:#111827; color:#fff; font-weight:700; cursor:pointer;
  }
  .btn[disabled]{opacity:.6; cursor:not-allowed}
  .msg{margin-top:10px; font-size:14px}
  .msg.error{color:#b91c1c}
  .msg.success{color:#166534}
  .footer{margin-top:16px; font-size:14px}
  a{color:#111827; text-decoration:none}
  a:hover{text-decoration:underline}
</style>
</head>
<body>
  <div class="card">
    <h1>Create your Achievify account</h1>
    <p class="sub">Already have one? <a href="login.html">Login</a></p>

    <form id="regForm" novalidate>
      <div class="row">
        <div>
          <label for="fullName">Full name</label>
          <input id="fullName" name="fullName" type="text" autocomplete="name" required />
        </div>
        <div>
          <label for="username">Username</label>
          <input id="username" name="username" type="text" minlength="3" maxlength="24" required />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="email">Email</label>
          <input id="email" name="email" type="email" autocomplete="email" required />
        </div>
        <div>
          <label for="phone">Phone (optional)</label>
          <input id="phone" name="phone" type="tel" placeholder="+91…" />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="password">Password</label>
          <input id="password" name="password" type="password" minlength="6" required />
        </div>
        <div>
          <label for="confirm">Confirm password</label>
          <input id="confirm" name="confirm" type="password" minlength="6" required />
        </div>
      </div>

      <button class="btn" id="submitBtn" type="submit">
        <span id="btnText">Create account</span>
        <span id="spinner" style="display:none">⏳</span>
      </button>
      <div class="msg" id="msg"></div>
    </form>

    <div class="footer"><a href="index.html">← Back to home</a></div>
  </div>

<script>
const form    = document.getElementById('regForm');
const msg     = document.getElementById('msg');
const btn     = document.getElementById('submitBtn');
const spinner = document.getElementById('spinner');
const btnText = document.getElementById('btnText');

function setMessage(text, ok=false){
  msg.textContent = text;
  msg.className = 'msg ' + (ok ? 'success' : 'error');
}

function setLoading(on){
  btn.disabled = on;
  spinner.style.display = on ? 'inline' : 'none';
  btnText.textContent = on ? 'Creating…' : 'Create account';
}

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  setMessage('');
  setLoading(true);

  const data = Object.fromEntries(new FormData(form).entries());

  // basic validation
  if(!data.fullName || !data.username || !data.email || !data.password || !data.confirm){
    setLoading(false); return setMessage('Please fill all required fields.');
  }
  if(data.password.length < 6){
    setLoading(false); return setMessage('Password must be at least 6 characters.');
  }
  if(data.password !== data.confirm){
    setLoading(false); return setMessage('Passwords do not match.');
  }

  try{
    const res = await fetch('/api/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        fullName: data.fullName.trim(),
        username: data.username.trim(),
        email: data.email.trim(),
        phone: data.phone?.trim() || null,
        password: data.password
      })
    });

    const out = await res.json().catch(()=> ({}));
    if(res.ok){
      setMessage('Account created ✔ You can login now.', true);
      form.reset();
      // redirect after a moment
      setTimeout(()=> location.href = 'login.html', 1200);
    } else {
      setMessage(out.message || 'Registration failed.');
    }
  }catch(err){
    setMessage('Server not reachable. Open this page via http://localhost:PORT from your Node server.');
  }finally{
    setLoading(false);
  }
});
</script>
</body>
</html>
